# CoAP客户

[支持的管道类型：](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Configuration/ProductIcons_Doc.html#concept_mjg_ly5_pgb)![img](imgs/icon-SDC-20200310183840769.png) 资料收集器![img](imgs/icon-Edge-20200310183841381.png) 数据收集器边缘

约束应用协议（CoAP）是一种为机器对机器设备设计的Web传输协议。CoAP客户端目标将数据写入CoAP端点。使用目标将请求发送到CoAP资源URL。

CoAP客户端目标为每个记录生成一个请求。配置目标时，可以定义用于请求的资源URL和方法。您可以配置每个请求是可确认的还是不可确认的。您还可以为每个请求配置连接超时。

## 资料格式

CoAP客户端目标根据您选择的数据格式将数据写入CoAP端点。

CoAP客户端目标处理数据格式如下：

- 二元

  该阶段将二进制数据写入记录中的单个字段。

- JSON格式

  目标将记录作为JSON数据写入。您可以使用以下格式之一：数组-每个文件都包含一个数组。在数组中，每个元素都是每个记录的JSON表示形式。多个对象-每个文件都包含多个JSON对象。每个对象都是记录的JSON表示形式。

- SDC记录

  目标以SDC记录数据格式写入记录。

- 文本

  目标将数据从单个文本字段写入目标系统。配置阶段时，请选择要使用的字段。

  您可以配置字符以用作记录分隔符。默认情况下，目标使用UNIX样式的行尾（\ n）分隔记录。

  当记录不包含选定的文本字段时，目标可以将缺少的字段报告为错误或忽略缺少的字段。默认情况下，目标报告错误。

  当配置为忽略缺少的文本字段时，目标位置可以丢弃该记录或写入记录分隔符以为该记录创建一个空行。默认情况下，目标丢弃记录。

## 配置CoAP客户端目标

配置CoAP客户端目标以将数据写入CoAP端点。

1. 在“属性”面板的“ **常规”**选项卡上，配置以下属性：

   | 一般财产                                                     | 描述                                                         |
   | :----------------------------------------------------------- | :----------------------------------------------------------- |
   | 名称                                                         | 艺名。                                                       |
   | 描述                                                         | 可选说明。                                                   |
   | [必填项](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/DroppingUnwantedRecords.html#concept_dnj_bkm_vq) | 必须包含用于将记录传递到阶段的记录的数据的字段。**提示：**您可能包括舞台使用的字段。根据为管道配置的错误处理，处理不包含所有必填字段的记录。 |
   | [前提条件](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/DroppingUnwantedRecords.html#concept_msl_yd4_fs) | 必须评估为TRUE的条件才能使记录进入处理阶段。单击 **添加**以创建其他前提条件。根据为阶段配置的错误处理，处理不满足所有前提条件的记录。 |
   | [记录错误](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/ErrorHandling.html#concept_atr_j4y_5r) | 该阶段的错误记录处理：放弃-放弃记录。发送到错误-将记录发送到管道以进行错误处理。停止管道-停止管道。对群集管道无效。 |

2. 在“ **CoAP”**选项卡上，配置以下属性：

   | CoAP物业 | 描述                                                         |
   | :------- | :----------------------------------------------------------- |
   | 资源网址 | CoAP资源URL。输入以下格式：`coap://:/`例如：`coap://localhost:5683/sdc` |
   | CoAP方法 | 为每个记录发送的CoAP请求方法：GET，POST，PUT或DELETE。       |
   | 请求类型 | 发送的CoAP请求的类型：可确认-CoAP服务器必须返回确认消息，目的地才能发送下一个请求。用于确保每个请求均已成功交付。不可确认-CoAP服务器不需要确认每个请求。用于提高性能。 |
   | 连接超时 | 每个请求等待连接到CoAP服务器的最大毫秒数。如果超过了超时，那么将根据为该阶段配置的错误处理来处理记录。然后目标将尝试发送下一个请求。使用0无限期等待。 |

3. 在“ **数据格式”**选项卡上，配置以下属性：

   | 数据格式属性 | 描述                                                         |
   | :----------- | :----------------------------------------------------------- |
   | 资料格式     | 消息的数据格式。使用以下数据格式之一：二元JSON格式[SDC记录](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Data_Formats/SDCRecordFormat.html#concept_qkk_mwk_br)文本 |

4. 对于二进制数据，在“ **数据格式”**选项卡上，配置以下属性：

   | 二元性质     | 描述                   |
   | :----------- | :--------------------- |
   | 二进制场路径 | 包含二进制数据的字段。 |

5. 对于JSON数据，在**数据格式**选项卡上，配置以下属性：

   | JSON属性 | 描述                                                         |
   | :------- | :----------------------------------------------------------- |
   | JSON内容 | 写入JSON数据的方法：JSON对象数组-每个文件都包含一个数组。在数组中，每个元素都是每个记录的JSON表示形式。多个JSON对象-每个文件包含多个JSON对象。每个对象都是记录的JSON表示形式。 |
   | 字符集   | 写入数据时使用的字符集。                                     |

6. 对于文本数据，在“ **数据格式”**选项卡上，配置以下属性：

   | 文字属性                       | 描述                                                         |
   | :----------------------------- | :----------------------------------------------------------- |
   | 文字栏位路径                   | 包含要写入的文本数据的字段。所有数据必须合并到指定字段中。   |
   | 记录分隔符                     | 用于分隔记录的字符。使用任何有效的Java字符串文字。例如，当写入Windows时，您可能会\r\n用来分隔记录。默认情况下，目标使用 \n。 |
   | 在失落的田野上                 | 当记录不包含文本字段时，确定目标是将丢失的字段报告为错误还是忽略该丢失的字段。 |
   | 如果没有文本，则插入记录分隔符 | 当配置为忽略缺少的文本字段时，插入配置的记录分隔符字符串以创建一个空行。如果未选择，则丢弃没有文本字段的记录。 |
   | 字符集                         | 写入数据时使用的字符集。                                     |