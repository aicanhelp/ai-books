# 命名管道

[支持的管道类型：](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Configuration/ProductIcons_Doc.html#concept_mjg_ly5_pgb)![img](imgs/icon-SDC-20200310202037034.png) 资料收集器

命名管道目标将数据写入UNIX命名管道。

可以通过计算机上的两个独立进程访问命名管道（或FIFO）-一个进程以写入器的形式打开管道，另一个进程以读取器的形式打开。命名管道目标充当编写者。在同一Data Collector计算机上运行的另一个进程可以用作读取器。

使用目标将数据发送到可以从命名管道读取数据的应用程序。例如，Greenplum `gpload`实用程序支持从命名管道加载数据。您可以将实用程序配置为从命名管道目标写入的命名管道中读取。然后，该实用程序可以将该数据加载到Greenplum数据库中。

使用命名管道目标之前，必须在安装了Data Collector的计算机上创建命名管道 。您还必须配置在Data Collector 计算机上运行的命名管道读取器（或读取应用程序），以从同一命名管道接收数据。

配置命名管道目标时，您输入创建的本地命名管道的完整路径。您还可以指定目标用来将数据写入命名管道的数据格式。

## 先决条件

在可以写入命名管道之前，必须完成以下先决条件：

- 在本地Data Collector计算机上创建命名管道。
- 在Data Collector本地计算机上配置命名管道读取器以从同一命名管道读取。

### 创建命名管道

使用`mkfifo`命令在 安装了Data Collector的同一台计算机上创建命名管道。

例如，使用以下命令创建本地命名管道：

```
mkfifo /tmp/my_pipe
```

### 配置命名管道读取器

命名管道读取器（或读取应用程序）必须安装在Data Collector 计算机上，并且必须配置为从同一命名管道读取。

例如，将读取器配置为从您使用以下`mkfifo`命令创建的相同命名管道读取：

```
/tmp/my_pipe
```

作为最佳实践，我们建议先启动阅读器，然后再启动包含命名管道目标的管道。

## 使用命名管道读取器

命名管道目标将数据写入命名管道，然后命名管道读取器（或读取应用程序）读取传入的数据。

考虑命名管道目标和命名管道读取器交互的以下方式：

- 如果在命名管道读取器可用于读取之前启动管道，则管道将保持在STARTING状态，直到读取器可用为止。

  作为最佳实践，我们建议先启动阅读器，然后再启动包含命名管道目标的管道。

- 当命名管道阅读器可用时，管道将转换为RUNNING状态，并且命名管道目标将开始写入命名管道。如果目标写入的速度快于读取器处理数据的速度，则命名管道可能已满。在这种情况下，目标将等待写入其他数据，直到命名管道可以接收更多数据为止。

- 如果在命名管道读取器仍然可用的同时管道停止，则读取器将收到中断管道的IOException。

- 如果在运行具有“命名管道”目标的管道时命名管道阅读器停止运行，则Data Collector将显示有关断开管道的阶段异常。

## 资料格式

“命名管道”目标根据您选择的数据格式将数据写入命名管道。目标支持为每个记录生成单行输出的数据格式。不支持为每个记录生成具有多行输出的嵌套结构的数据格式，例如XML数据格式。

您可以使用以下数据格式：

- 定界

  目标将记录写为定界数据。使用此数据格式时，根字段必须是list或list-map。

  您可以使用以下定界格式类型：**默认CSV-**包含逗号分隔值的文件。忽略文件中的空行。**RFC4180 CSV-**严格遵循RFC4180准则的逗号分隔文件。**MS Excel CSV** -Microsoft Excel逗号分隔文件。**MySQL CSV** -MySQL逗号分隔文件。**制表符分隔的值** -包含制表符分隔的值的文件。**PostgreSQL CSV** -PostgreSQL逗号分隔文件。**PostgreSQL文本** -PostgreSQL文本文件。**自定义** -使用用户定义的定界符，转义符和引号字符的文件。**多字符**定界-使用多个用户定义的字符定界字段和行以及单个用户定义的转义和引号字符的文件。

- JSON格式

  目标将记录作为JSON数据写入。您可以使用以下格式之一：数组-每个文件都包含一个数组。在数组中，每个元素都是每个记录的JSON表示形式。多个对象-每个文件都包含多个JSON对象。每个对象都是记录的JSON表示形式。

- SDC记录

  目标以SDC记录数据格式写入记录。

- 文本

  目标将数据从单个文本字段写入目标系统。配置阶段时，请选择要使用的字段。

  您可以配置字符以用作记录分隔符。默认情况下，目标使用UNIX样式的行尾（\ n）分隔记录。

  当记录不包含选定的文本字段时，目标可以将缺少的字段报告为错误或忽略缺少的字段。默认情况下，目标报告错误。

  当配置为忽略缺少的文本字段时，目标位置可以丢弃该记录或写入记录分隔符以为该记录创建一个空行。默认情况下，目标丢弃记录。

## 配置命名管道目标

配置命名管道目标以将数据写入UNIX命名管道。

1. 在“属性”面板的“ **常规”**选项卡上，配置以下属性：

   | 一般财产                                                     | 描述                                                         |
   | :----------------------------------------------------------- | :----------------------------------------------------------- |
   | 名称                                                         | 艺名。                                                       |
   | 描述                                                         | 可选说明。                                                   |
   | [必填项](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/DroppingUnwantedRecords.html#concept_dnj_bkm_vq) | 必须包含用于将记录传递到阶段的记录的数据的字段。**提示：**您可能包括舞台使用的字段。根据为管道配置的错误处理，处理不包含所有必填字段的记录。 |
   | [前提条件](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/DroppingUnwantedRecords.html#concept_msl_yd4_fs) | 必须评估为TRUE的条件才能使记录进入处理阶段。单击 **添加**以创建其他前提条件。根据为阶段配置的错误处理，处理不满足所有前提条件的记录。 |
   | [记录错误](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/ErrorHandling.html#concept_atr_j4y_5r) | 该阶段的错误记录处理：放弃-放弃记录。发送到错误-将记录发送到管道以进行错误处理。停止管道-停止管道。对群集管道无效。 |

2. 在“ **命名管道”**选项卡上，配置以下属性：

   | 命名管道属性                                                 | 描述                                              |
   | :----------------------------------------------------------- | :------------------------------------------------ |
   | 命名管道 [![img](imgs/icon_moreInfo-20200310202037102.png)](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Destinations/NamedPipe.html#concept_drt_4lk_mcb) | 使用该`mkfifo`命令创建的本地命名管道的完整路径 。 |

3. 在“ **数据格式”**选项卡上，配置以下属性：

   | 数据格式属性 | 描述                                                         |
   | :----------- | :----------------------------------------------------------- |
   | 资料格式     | 数据格式写入数据：定界JSON格式SDC记录 [![img](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Graphics/icon_moreInfo.png)](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/SDCRecordFormat.html#concept_qkk_mwk_br)文本 |

4. 对于定界数据，在“ **数据格式”**选项卡上，配置以下属性：

   | 定界财产   | 描述                                                         |
   | :--------- | :----------------------------------------------------------- |
   | 分隔符格式 | 分隔数据的格式：**默认CSV-**包含逗号分隔值的文件。忽略文件中的空行。**RFC4180 CSV-**严格遵循RFC4180准则的逗号分隔文件。**MS Excel CSV** -Microsoft Excel逗号分隔文件。**MySQL CSV** -MySQL逗号分隔文件。**制表符分隔的值** -包含制表符分隔的值的文件。**PostgreSQL CSV** -PostgreSQL逗号分隔文件。**PostgreSQL文本** -PostgreSQL文本文件。**自定义** -使用用户定义的定界符，转义符和引号字符的文件。 |
   | 标题行     | 指示是否创建标题行。                                         |
   | 替换换行符 | 用配置的字符串替换换行符。在将数据写为单行文本时推荐使用。   |
   | 换行符替换 | 用于替换每个换行符的字符串。例如，输入一个空格，用空格替换每个换行符。留空以删除新行字符。 |
   | 分隔符     | 自定义分隔符格式的分隔符。选择一个可用选项，或使用“其他”输入自定义字符。您可以输入使用格式\ U A的Unicode控制符*NNNN*，其中*ñ*是数字0-9或字母AF十六进制数字。例如，输入\ u0000将空字符用作分隔符，或者输入\ u2028将行分隔符用作分隔符。默认为竖线字符（\|）。 |
   | 转义符     | 自定义分隔符格式的转义符。选择一个可用选项，或使用“其他”输入自定义字符。默认为反斜杠字符（\）。 |
   | 引用字符   | 自定义分隔符格式的引号字符。选择一个可用选项，或使用“其他”输入自定义字符。默认为引号字符（“”）。 |
   | 字符集     | 写入数据时使用的字符集。                                     |

5. 对于JSON数据，在**数据格式**选项卡上，配置以下属性：

   | JSON属性 | 描述                                                         |
   | :------- | :----------------------------------------------------------- |
   | JSON内容 | 写入JSON数据的方法：JSON对象数组-每个文件都包含一个数组。在数组中，每个元素都是每个记录的JSON表示形式。多个JSON对象-每个文件包含多个JSON对象。每个对象都是记录的JSON表示形式。 |
   | 字符集   | 写入数据时使用的字符集。                                     |

6. 对于文本数据，在“ **数据格式”**选项卡上，配置以下属性：

   | 文字属性                       | 描述                                                         |
   | :----------------------------- | :----------------------------------------------------------- |
   | 文字栏位路径                   | 包含要写入的文本数据的字段。所有数据必须合并到指定字段中。   |
   | 记录分隔符                     | 用于分隔记录的字符。使用任何有效的Java字符串文字。例如，当写入Windows时，您可能会\r\n用来分隔记录。默认情况下，目标使用 \n。 |
   | 在失落的田野上                 | 当记录不包含文本字段时，确定目标是将丢失的字段报告为错误还是忽略该丢失的字段。 |
   | 如果没有文本，则插入记录分隔符 | 当配置为忽略缺少的文本字段时，插入配置的记录分隔符字符串以创建一个空行。如果未选择，则丢弃没有文本字段的记录。 |
   | 字符集                         | 写入数据时使用的字符集。                                     |