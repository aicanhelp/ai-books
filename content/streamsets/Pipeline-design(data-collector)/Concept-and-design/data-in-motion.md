# 动态数据

数据分批通过管道。这就是它在数据收集器 级别上的工作方式：

原点会在从原点系统读取数据或从原点系统读取数据时创建批处理，并注意偏移量。偏移量是原点停止读取的位置。

当批次已满或超过批次等待时间限制时，源将发送批次。批次在处理器之间通过管道移动，直到到达管道目的地。

目标将批处理写入目标系统，然后Data Collector在内部提交偏移量。基于管道交付保证，Data Collector要么在将偏移写入任何目标系统后立即提交偏移，要么在收到来自所有目标系统的写入确认后立即提交偏移。偏移提交后，原始阶段将创建一个新批次。

请注意，这描述了一般的管道行为。行为可能因特定的管道配置而异。例如，对于Kafka使用者，偏移量存储在Kafka或ZooKeeper中。对于不存储数据的原始系统（例如Omniture和HTTP Client），因为不相关，所以不存储偏移量。

在多个Data Collector上运行管道时，Control Hub会跟踪每个Data Collector提交的所有偏移量。有关Control Hub作业的更多信息，请参见“ [作业概述”](https://streamsets.com/documentation/controlhub/latest/help/controlhub/UserGuide/Jobs/Jobs.html#concept_omz_yn1_4w)。

## 单线程和多线程管道

上面的信息描述了标准的单线程管道-原始服务器创建一个批次并将其通过管道，仅在处理前一个批次之后才创建新批次。

某些源可能会生成多个线程，以在多线程管道中启用并行处理 。在多线程管道中，您可以配置源以创建要使用的线程数或并发量。 然后，Data Collector根据管道的“ Max Runners”属性创建许多管道运行器，以执行管道处理。每个线程都连接到原始系统，创建一批数据，并将该批数据传递给可用的管道运行器。

每个管道运行程序一次处理一个批处理，就像在单个线程上运行的管道一样。当数据流减慢时，管道运行器会闲置等待，直到需要它们为止，并定期生成一个空批。您可以配置“运行者空闲时间”管道属性来指定间隔或选择退出空批次生成。

本指南中对管道的所有常规引用都描述了单线程管道，但是此信息通常适用于多线程管道。有关特定于多线程管道的更多详细信息，请参阅《[多线程管道概述》](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Multithreaded_Pipelines/MultithreadedPipelines.html#concept_zpp_2xc_py)。

## 交货保证

配置管道时，可以定义如何处理数据：是否要防止数据丢失或数据重复？

交付保证管道属性提供以下选择：

- 至少一次

  确保管道处理所有数据。

  如果故障导致Data Collector在处理一批数据时停止，则重新启动时将重新处理该批处理。此选项可确保没有数据丢失。

  使用此选项，Data Collector 在从目标系统收到写入确认后提交偏移量。如果在Data Collector 将数据传递到目标系统之后但在收到确认并提交偏移之前发生故障，则在目标系统中最多可以复制一个批处理数据。

- 最多一次

  确保不重复处理数据。

  如果故障导致Data Collector在处理一批数据时停止，则在启动时，它将开始处理下一批数据。此选项可避免由于重新处理而导致目的地数据重复。

  使用此选项，Data Collector 在写入后提交偏移量，而无需等待目标系统的确认。如果在Data Collector 将数据传递到目标并提交偏移量后发生故障，则可能最多不会将一批数据写入目标系统。

## 数据收集器 数据类型

在管道中， Data Collector 使用以下数据类型，在读取或写入外部系统时根据需要转换数据：

| 数据类型       | 描述                                                         |
| :------------- | :----------------------------------------------------------- |
| 布兰           | 对或错。对应于布尔Java数据类型。                             |
| 字节           | 8位带符号整数。范围从-128到127。对应于Byte Java数据类型。    |
| BYTE_ARRAY     | 字节值数组。对应于Byte [] Java数据类型。                     |
| 字符           | 存储单个Unicode字符。对应于Char Java数据类型。               |
| 日期           | 时间对象，包括日，月和四位数的年份。不包括时区。             |
| 约会时间       | 时间对象，包括日，月，四位数的年份，小时，分钟和秒。精确到毫秒。不包括时区。 |
| 十进制         | 任意精度带符号十进制数字。对应于BigDecimal Java类。          |
| 双             | 64位双精度IEEE 754浮点数。对应于Double Java数据类型。        |
| FILE_REF       | [整个文件格式的](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Data_Formats/WholeFile.html#concept_nfc_qkh_xw)内部类型。 |
| 浮动           | 32位单精度IEEE 754浮点。对应于Float Java数据类型。           |
| 整数           | 32位带符号的整数。对应于Int Java数据类型。                   |
| 清单           | 嵌套类型。包含值的枚举列表。值可以是任何类型，列表中的每个值可以是不同类型。 |
| LIST_MAP       | 嵌套类型。包含按特定顺序保留的键/值对列表。键始终是字符串。值可以是任何类型，每个值可以是不同的类型。 |
| 长             | 64位签名整数。范围从-9,223,372,036,854,775,808到9,223,372,036,854,775,807。对应于Long Java数据类型。 |
| 地图           | 嵌套类型。包含键值对列表。键始终是字符串。值可以是任何类型，每个值可以是不同的类型。 |
| 短             | 16位带符号的整数。范围从-32,768到32767。对应于Short Java数据类型。 |
| 串             | 文本。对应于String Java类。                                  |
| 时间           | 时间对象，包括小时，分钟和秒。精确到毫秒。不包括时区。       |
| ZONED_DATETIME | 时间对象，包括日，月，四位数的年份，小时，分钟，秒和时区。精确到纳秒。对应于ZonedDateTime Java类。 |