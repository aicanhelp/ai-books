# Redis查询

[支持的管道类型：](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Configuration/ProductIcons_Doc.html#concept_mjg_ly5_pgb)![img](imgs/icon-SDC-20200310181649657.png) 资料收集器

例如，您可以将处理器配置为使用城市字段作为关键字来在Redis中查找邮政编码值，并将这些值传递给新的zip_code输出字段。

在配置Redis查找处理器时，可以指定处理器是对批处理中的所有键执行批量查找，还是对记录中的每个键执行单独查找。您可以使用表达式来定义要在Redis中查找的键，并指定用于向其中写入查找值的输出字段。您还可以指定Redis值的数据类型。

您可以将处理器配置为在本地缓存键值对以提高性能。

您还可以指定用于连接到Redis的属性，包括Redis服务器的URI。

## 资料类型

当您定义要在Redis中查找的键时，可以指定Redis值的数据类型。Redis查找处理器将Redis数据类型转换为Data Collector数据类型。

下表列出了受支持的Redis数据类型和相应的Data Collector 数据类型：

| Redis数据类型 | 数据收集器数据类型                                           |
| :------------ | :----------------------------------------------------------- |
| 串            | 串                                                           |
| 清单          | 清单。将数据转换为索引的值列表，例如：`0:  1:  2: `          |
| 杂凑          | 地图。将数据转换为Redis字段名称和值的映射，例如：`/:  /:  /: ` |
| 组            | 清单。将数据转换为索引的值列表，例如：`0:  1:  2: `          |

**注意：**不支持其余的Redis数据类型。

## 查找缓存

为了提高管道性能，您可以将Redis查找处理器配置为本地缓存从Redis返回的键值对。

处理器缓存键值对，直到缓存达到最大大小或到期时间。当达到第一个限制时，处理器从缓存中逐出键值对。

您可以配置以下方式从缓存中逐出键值对：

- 基于规模的驱逐

  配置处理器缓存的键/值对的最大数量。当达到最大数量时，处理器将从高速缓存中逐出最旧的键值对。

- 基于时间的驱逐

  配置键值对可以保留在缓存中而不被写入或访问的时间。当到达到期时间时，处理器从高速缓存中逐出密钥。驱逐策略确定处理器是否测量自上次写入值或自上次访问值以来的到期时间。

  例如，您将逐出策略设置为在上次访问后到期，并将到期时间设置为60秒。处理器在60秒内未访问键值对之后，处理器会将其从缓存中逐出。

当您停止管道时，处理器将清除缓存。

## 配置Redis查找处理器

配置Redis查找处理器以在Redis中执行键值查找。

1. 在“属性”面板的“ **常规”**选项卡上，配置以下属性：

   | 一般财产                                                     | 描述                                                         |
   | :----------------------------------------------------------- | :----------------------------------------------------------- |
   | 名称                                                         | 艺名。                                                       |
   | 描述                                                         | 可选说明。                                                   |
   | [必填项](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/DroppingUnwantedRecords.html#concept_dnj_bkm_vq) | 必须包含用于将记录传递到阶段的记录的数据的字段。**提示：**您可能包括舞台使用的字段。根据为管道配置的错误处理，处理不包含所有必填字段的记录。 |
   | [前提条件](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/DroppingUnwantedRecords.html#concept_msl_yd4_fs) | 必须评估为TRUE的条件才能使记录进入处理阶段。单击 **添加**以创建其他前提条件。根据为阶段配置的错误处理，处理不满足所有前提条件的记录。 |
   | [记录错误](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Pipeline_Design/ErrorHandling.html#concept_atr_j4y_5r) | 该阶段的错误记录处理：放弃-放弃记录。发送到错误-将记录发送到管道以进行错误处理。停止管道-停止管道。对群集管道无效。 |

2. 在“ **查找”**选项卡上，配置以下属性：

   | 查找属性                                                     | 描述                                                         |
   | :----------------------------------------------------------- | :----------------------------------------------------------- |
   | 模式                                                         | 用于执行查找的模式：每批次-对批次中的所有密钥执行批量查找。处理器对每个批次执行一次查找。每个记录中的每个键-对每个记录中的每个键执行单独的查找。如果配置多个键表达式，则处理器将为每个记录执行多个查找。默认值为“每批”。 |
   | 关键表达                                                     | 在Redis中查找的关键。输入密钥名称或输入定义该密钥的表达式。例如，输入以下表达式以将“城市”字段中的数据用作查找关键字：`${record:value('/city')}` |
   | 输出场                                                       | 记录中要传递查找值的字段名称。您可以指定现有字段或新字段。如果该字段不存在，则Redis查找将创建该字段。 |
   | 数据类型 [![img](imgs/icon_moreInfo-20200310181650144.png)](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Processors/RedisLookup.html#concept_qs3_zz4_zv) | Redis中值的数据类型。默认为字符串。                          |
   | 启用本地缓存[![img](imgs/icon_moreInfo-20200310181650144.png)](https://streamsets.com/documentation/controlhub/latest/help/datacollector/UserGuide/Processors/RedisLookup.html#concept_zcg_21p_zv) | 指定是否在本地缓存返回的键值对。                             |
   | 缓存的最大条目数                                             | 要缓存的键/值对的最大数量。当达到最大数量时，处理器将从高速缓存中逐出最旧的键值对。默认值为-1，表示无限制。 |
   | 驱逐政策类型                                                 | 过期时间过后，用于从本地缓存中逐出键/值对的策略：上次访问后过期-计算自读取或写入最后一次访问键值对以来的过期时间。上次写入后过期-测量自创建键值对以来或自上次替换值以来的过期时间。 |
   | 到期时间                                                     | 键值对可以保留在本地缓存中而不被访问或写入的时间。默认值为1秒。 |
   | 时间单位                                                     | 到期时间的时间单位。默认值为秒。                             |

3. 在“ **Redis”**选项卡上，配置以下属性：

   | Redis物业      | 描述                                                         |
   | :------------- | :----------------------------------------------------------- |
   | URI            | Redis服务器的URI。使用以下格式：`redis://:/`如果服务器使用默认数据库，则可以省略数据库。您可以选择包括密码以登录到Redis服务器。例如：`redis://:@:/` |
   | 连接超时（秒） | 等待连接的最长时间（以秒为单位）。默认值为60秒。             |